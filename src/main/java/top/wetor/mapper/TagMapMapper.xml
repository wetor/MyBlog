<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="top.wetor.mapper.TagMapMapper">

    <insert id="insertTagMap" parameterType="TagMap">
        insert into tb_tag_map
        values(#{t_id} ,#{a_id})
    </insert>
    <insert id="insertTagMapByArticle" parameterType="Integer">
        <if test="tags!=null">
            insert tb_tag_map(t_id,a_id) values
            <foreach item="content" collection="tags.split(',')" separator="," >
                    (select t_id from tb_tag where t_content=#{content}
                    ,#{a_id})
            </foreach>
        </if>
    </insert>

    <delete id="deleteTagMapByArticleId" parameterType="Integer">
        delete from tb_tag_map
        Where a_id = #{a_id}
    </delete>



    <select id="selectTagByArticleId" parameterType="Integer" resultType="Tag">
        select * from tb_tag
        where t_id in (
            select * from tb_tag_map
            where a_id = #{a_id}
        )
    </select>
    <select id="selectArticleByTagId" resultType="Article">
        select
        a_id,
        g_id,
        u_id,
        a_title,
        a_tags,
        a_create_time,
        a_modify_time,
        a_look,
        a_love,
        a_cache_path,
        a_is_top,
        a_is_hidden,
        a_is_delete
        <if test="param2==null or param2==0">
        </if>
        <if test="param2==1">
            ,substr(a_content,1,256)
        </if>
        <if test="param2==2">
            ,a_content
        </if>
        from tb_article
        where find_in_set(
        (select t_content from tb_tag where t_id=#{t_id})
        ,a_tags
        )>0
        ORDER BY a_create_time
        <if test=" param3 == null or param3 == false ">
            desc
        </if>
    </select>
</mapper>